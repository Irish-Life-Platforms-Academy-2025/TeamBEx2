jobs:
  - job: plan_terraform
    displayName: "Run Plan"
    steps:
      - task: TerraformTaskV4@4
        displayName: 'Select Workspace'
        inputs:
          provider: 'azurerm'
          command: 'custom'
          customCommand: 'workspace'
          commandOptions: 'select $(env)'
          outputTo: 'console'
          environmentServiceNameAzureRM: '$(ServiceConnectionName)'

      - task: TerraformTaskV4@4
        displayName: 'Plan'
        inputs:
          command: 'plan'
          commandOptions: '-var-file=$(tfpasswords.secureFilePath)'
          workingDirectory: '$(System.DefaultWorkingDirectory)'
          environmentServiceNameAzureRM: $(ServiceConnectionName)
        continueOnError: false

